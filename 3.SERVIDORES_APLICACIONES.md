# **UNIDAD 3:** SERVIDORES DE APLICACIONES

### Links externos de esta unidad:

- üìä [Diapositivas de la Unidad 3](http://jamj2000.github.io/despliegueaplicacionesweb/3/diapositivas)
- üìö [Actividades de la Unidad 3](http://jamj2000.github.io/despliegueaplicacionesweb/3/actividades)
- üîô [Volver a README](README)

---

## √çndice

- 1 - Introducci√≥n
  - 1.1 - En esta Unidad aprenderemos
- 2 - Conceptos b√°sicos
  - 2.1 - Ediciones de Java
  - 2.2 - Tipos de archivos
- 3 - Tomcat
  - 3.1 - Instalaci√≥n
  - 3.2 - Configuraci√≥n
  - 3.3 - Construir webapp
  - 3.4 - Desplegar en tomcat
- 4 - JBoss / WildFly
- 5 - Contenedores Docker
  - 5.1 - Caracter√≠sticas de Docker
  - 5.2 - Ventajas y desventajas de Docker
  - 5.3 - Comandos de docker
  - 5.4 - docker-compose

---

## 1Ô∏è‚É£ - Introducci√≥n

### 1.1 - En esta Unidad aprenderemos a

- Identificar los principales archivos de configuraci√≥n y de bibliotecas compartidas.
- Realizar los ajustes necesarios para el despliegue de aplicaciones sobre el servidor.
- Realizar pruebas de funcionamiento y rendimiento de la aplicaci√≥n Web desplegada.
- Elaborar documentaci√≥n relativa al despliegue de aplicaciones sobre el servidor de aplicaciones.

- - - 

## 2Ô∏è‚É£ - Conceptos b√°sicos

### 2.1 - Ediciones de Java

- **Java Card**
- **Micro Edition** (**ME**)
- **Standard Edition** (**SE**)
- **Enterprise Edition** (**EE**)
- **JavaFX**

### 2.2 - Tipos de archivos

- **JAR** (Java ARchive): Permite almacenar aplicaciones escritas en el lenguaje Java. Formato ZIP pero extensi√≥n .jar.

- **WAR** (Web Application aRchive): Es un archivo JAR (con la extensi√≥n WAR) para distribuir archivos JSP, servlets, clases Java, archivos XML y contenido web est√°tico (HTML). En conjunto constituyen una aplicaci√≥n Web.

- **EAR** (Enterprise Application aRchive): Formato usado por Java EE para empaquetar en un s√≥lo archivo varios m√≥dulos y para desplegar (mediante archivos XML llamados descriptores de depliegue) en un servidor de aplicaciones.

---

## 3Ô∏è‚É£ - TOMCAT

**Servidor web y Contenedor de servlets**

![Tomcat](assets/tomcat.png)

### 3.1 - Instalaci√≥n

```bash
# En Ubuntu 16.04 y 18.04
apt  install  tomcat8   tomcat8-admin

# Opcionalmente puede instalarse tambi√©n
apt  install  tomcat8-docs  tomcat8-examples
```

Una vez instalado, Tomcat estar√° disponible en **http://localhost:8080**

### 3.2 - Configuraci√≥n

```bash
/etc/tomcat8/
/etc/tomcat8/tomcat-users.xml
```

Insertamos las siguientes l√≠neas en **/etc/tomcat8/tomcat-users.xml**.

```xml
<role rolename="manager-gui"/>
<role rolename="admin-gui"/>
<user username="tomcat" password="tomcat" roles="manager-gui,admin-gui"/>
```

### 3.3 - Construir webapp

1. Descargamos c√≥digo fuente de aplicaci√≥n
2. Revisamos los siguientes archivos

```
<SOURCE>/pom.xml
<SOURCE>/src/main/resources/applicationContext.xml
```

3. Construimos con maven

```bash
mvn  clean  package
```

4. Revisamos los archivos generados

```
<SOURCE>/target/<APP>.war
<SOURCE>/target/<APP>/
```

### 3.4 - Desplegar en tomcat

1. Accedemos a **http://localhost:8080/manager/html**
2. Seleccionamos archivo **`.war`** a desplegar.
3. Y pulsamos en bot√≥n **Desplegar**.

#### Carpetas de una Webapp

```bash
/var/lib/tomcat8/
/var/lib/tomcat8/webapps/
/var/lib/tomcat8/webapps/<APP>/WEB-INF/web.xml
/var/lib/tomcat8/webapps/<APP>/WEB-INF/lib/
/var/lib/tomcat8/webapps/<APP>/WEB-INF/classes/
/var/lib/tomcat8/webapps/<APP>/WEB-INF/classes/applicationContext.xml
```

- Directorio principal (ra√≠z): Contendr√° los ficheros est√°ticos (HTML, im√°genes, etc...).
  - Carpeta **`WEB-INF`** : contiene el fichero **`web.xml`** (descriptor de la aplicaci√≥n), encargado de configurar la aplicaci√≥n.
    - Subcarpeta **`classes`** : contiene los ficheros compilados (servlets, beans).
    - Subcarpeta **`lib`** : librer√≠as adicionales.
  - Resto de carpetas para ficheros est√°ticos.

---

## 4Ô∏è‚É£ - JBOSS / WILDFLY

**Servidor de aplicaciones**

![WildFly](assets/wildfly.png)

#### Caracter√≠sticas

- Tambi√©n conocido como **WildFly Application Server**
- Servidor de aplicaciones de c√≥digo abierto.
- Implementa la especificaci√≥n Java EE.
- Anteriormente conocido como **JBoss AS**.
- Escrito en Java. Desarrollado por **RedHat**.

---

## 5Ô∏è‚É£ - Contenedores Docker

#### VMs / Containers

![VMs vs Containers](assets/vm-container.jpg)

![Docker](assets/docker.png)

### 5.1 - Caracter√≠sticas de Docker

- Proyecto de c√≥digo abierto.
- Actualmente es est√°ndar de facto en contenedores. Otros sistemas son LXD, LXC, RKT, ...
- Permite automatizar el despliegue de aplicaciones dentro de "contenedores".
- Un contenedor empaqueta todo lo necesario para que una aplicaci√≥n funcione: c√≥digo y dependencias.
- No hay que preocuparse de qu√© software ni versiones tiene nuestra m√°quina.
- Un contenedor es un objeto portable, ligero y autosuficiente.

### 5.2 - Ventajas y desventajas de Docker

#### Ventajas

- Los contenedores se inician en pocos segundos.
- Son f√°cilmente replicables.
- Consumen menos recursos que las m√°quinas virtuales tradicionales.
- Ocupan mucho menos espacio.
- Permite aislar las dependencias de una aplicaci√≥n de las instaladas en el host.
- Existe un gran repositorio de im√°genes ya creadas, que adem√°s
  pueden modificarse libremente. Es DockerHub: https://hub.docker.com

#### Desventajas

- Los contenedores no est√°n 100% aislados. Usan el kernel del anfitri√≥n.
- Mejor rendimiento en Linux que en otras plataformas.
- Existe cierta curva de aprendizaje.

### 5.3 - Comandos de docker

```bash
docker login/logout       # Inicia/cierra sesi√≥n en nuestra cuenta de dockerhub.
docker pull ‚Ä¶             # Baja una imagen de dockerhub.
docker push ‚Ä¶             # Sube una imagen a dockerhub.
docker run ‚Ä¶              # Lanza un contenedor a partir de una imagen
docker exec               # Para ejecutar un comando dentro del contenedor (ej: bash).
docker images             # Muestra las im√°genes que tenemos.
docker ps                 # Muestra los contenedores
docker ps -a              # Muestra todos los contenedores (funcionando y parados)
docker stop ‚Ä¶             # Detiene el proceso de un contenedor que estemos usando.
docker start ‚Ä¶            # Inicia el proceso de un contenedor.
docker restart ‚Ä¶          # Reinicia el proceso de un contenedor.
docker commit ‚Ä¶           # Crea una imagen con los cambios hechos en un contenedor.
docker rm ‚Ä¶               # Borra un contenedor que est√© parado.
docker rm -f ‚Ä¶            # Fuerza el borrado de un contenedor que est√© funcionando.
docker rmi ‚Ä¶              # Borra im√°genes.
docker rmi -f             # Fuerza el borrado de im√°genes usadas en un contenedor.
docker container prune    # Elimina todos los contenedores que est√©n parados.

```

#### docker run

- Nos permite ejecutar un contenedor a partir de una imagen.
- Si no tenemos la imagen localmente, entonces la descarga.

```bash
docker  run  -d  -p 8090:80  -v /var/www/html:/usr/share/nginx/html  nginx
```

**Opciones**

- `-d`, `--detach`: libera el terminal, se ejecuta en segundo plano.
- `-p ...`, `--publish=...`: puertos de red mapeados en localhost.
- `-v ...`, `--volume=...`: directorios mapeados en localhost.

#### docker exec

- Nos permite lanzar un ejecutable del interior del contenedor.
- A menudo el comando a lanzar es `bash`, para trabajar dentro del contenedor.

```bash
docker  exec  -it  9a60b60be82d  bash
```

**Opciones**

- `-i`, `--interactive`: mantiene STDIN abierta
- `-t`, `--tty`: se reserva un terminal pseudo-TTY
- `9a60b60be82d`: es el ID del contenedor, puede obtenerse con `docker ps`

### 5.4 - docker-compose

![Docker compose](assets/docker-compose.png)

#### Caracter√≠sticas de docker-compose

- Permite definir y ejecutar aplicaciones multicontenedor.
- Usa un archivo YAML para configurar los servicios de la aplicaci√≥n.
- Dicho archivo por defecto se llama `docker-compose.yml`.
- Con un solo comando, crea e inicia todos los servicios.

#### Ejemplo docker-compose.yml

```yaml
version: "2"
services:
  tomcat:
    image: "tomcat:8.0-jre8"
    ports:
      - "8080:8080"
    depends_on:
      - sqlserver
  sqlserver:
    image: "microsoft/mssql-server-linux:2017-latest"
    environment:
      SA_PASSWORD: "Temporal22"
      ACCEPT_EULA: "Y"
    volumes: ./docs:/data
```

#### Comandos de docker-compose

```bash
docker-compose  up  -d
docker-compose  down
```
